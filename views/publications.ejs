<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Publications</title>
    <%- include("./partials/head") %>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      crossorigin="anonymous"
    />
    <style>
      .search-box:focus {
        outline: none;
      }

      .search-container {
        transition: transform 0.2s ease-in-out, border 0.2s ease-in-out;
      }

      .search-container:focus-within {
        transform: scale(1.02);
        border: 2px solid #6cb2eb;
        border-radius: 6px;
      }

      .filter-btn {
        display: inline-flex !important; /* Ensures transform applies */
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease-in-out !important;
      }

      .filter-btn:hover {
        transform: scale(1.1) !important; /* Force scaling on hover */
      }

      .filter-dropdown {
        min-width: 15rem; /* Adjust width */
        padding: 0.6rem;
        border: none;
        border-radius: 5px;
        background-color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s ease-in-out, border 0.2s ease-in-out;
      }

      .filter-dropdown:focus {
        outline: none;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <%- include("./partials/navBar") %>
    <div
      class="p-3 d-flex justify-content-center"
      style="background-color: #2b3035"
    >
      <!-- Search Container -->
      <div id="search-section">
        <form action="/publications/search-by-title" method="GET">
          <div class="search-container d-flex align-items-center me-3">
            <input
              type="text"
              id="title"
              name="title"
              class="p-2 search-box"
              style="
                min-width: 40rem;
                border-radius: 5px 0px 0px 5px;
                border: none;
              "
              placeholder="Search For Publications..."
              autocomplete="off"
              oninput="fetchSuggestions()"
            />
            <button
              type="submit"
              class="btn btn-primary px-3 py-2"
              style="border-radius: 0px 5px 5px 0px"
            >
              <i class="fas fa-search"></i>
            </button>
          </div>
        </form>
      </div>

      <!-- New Div (Initially Hidden) -->
      <div id="filter-section" class="d-none d-flex gap-3 me-3">
        <select class="filter-dropdown">
          <option selected disabled>Select Year</option>
          <option>All</option>
          <option>2024</option>
          <option>2023</option>
          <option>2022</option>
        </select>

        <select class="filter-dropdown">
          <option selected disabled>Select Journal</option>
          <option>All</option>
          <option>Journal A</option>
          <option>Journal B</option>
          <option>Journal C</option>
        </select>

        <select class="filter-dropdown">
          <option selected disabled>Select Author</option>
          <option>All</option>
          <option>Author X</option>
          <option>Author Y</option>
          <option>Author Z</option>
        </select>
      </div>

      <!-- Filter Button -->
      <button
        type="button"
        class="btn btn-outline-light px-3 py-2 filter-btn"
        onclick="toggleSearchContainer()"
      >
        <i class="fa-solid fa-filter"></i>
      </button>
    </div>

    <div class="container mt-4">
      <h1 class="display-4 fw-bold text-center text-primary">Publications</h1>
      <p class="lead text-muted text-center" style="font-size: 1.75rem">
        Explore our latest research contributions
      </p>

      <div class="row row-cols-3 g-4 mb-4">
        <% if (locals.publications) { %> <% publications.forEach(publication =>
        { %>
        <div class="col">
          <div
            class="card h-100 shadow-lg border-0 rounded"
            style="background-color: #f9f9f9"
          >
            <div class="card-body">
              <h5 class="card-title text-dark fw-bold">
                <span style="color: #4da3ff"
                  ><%= publication.doc_number %>.</span
                >
                <%= publication.title %>
              </h5>
              <p class="card-text text-muted mb-1">
                <strong>Author(s):</strong> <%= publication.author %>
              </p>
              <p class="card-text text-muted mb-1">
                <strong>Year:</strong> <%= publication.year %>
              </p>
              <p class="card-text text-muted">
                <strong>Journal:</strong> <%= publication.journal %>
              </p>
            </div>
            <div class="card-footer text-center">
              <a
                href="<%= publication.journal_link %>"
                target="_blank"
                class="btn btn-primary btn-sm"
                >Read More</a
              >
            </div>
          </div>
        </div>
        <% }) %> <% } %>
      </div>
    </div>

    <%- include("./partials/footer") %> <%- include("./partials/script") %>
    <script>
      function toggleSearchContainer() {
        console.log("hello world");
        const searchSection = document.getElementById("search-section");
        const filterSection = document.getElementById("filter-section");

        if (searchSection.style.display === "none") {
          searchSection.style.display = "block"; // Show search
          filterSection.classList.add("d-none"); // Hide filter section
        } else {
          searchSection.style.display = "none"; // Hide search
          filterSection.classList.remove("d-none"); // Show filter section
        }
      }
    </script>

    <script>
      // Function to fetch search suggestions based on user input
      async function fetchSuggestions() {
        const searchText = document.getElementById("title").value.trim(); // Get user input
        const suggestionsBox = document.getElementById("suggestions"); // Get the suggestions container

        // If input is less than 2 characters, clear the suggestions and stop fetching
        if (searchText.length < 2) return (suggestionsBox.innerHTML = "");

        try {
          // Send an asynchronous GET request to the server for suggestions
          const response = await fetch(`/suggestions?searchText=${searchText}`);
          const data = await response.json(); // Convert response to JSON

          console.log(searchText);
          console.log(response);
          console.log(data);
          
          // Generate clickable suggestion items dynamically
          suggestionsBox.innerHTML = data
            .map(
              ({ title }) =>
                `<a href="#" class="list-group-item" onclick="selectTitle('${title}')">${title}</a>`
            )
            .join(""); // Join array into a single HTML string

          // Show the dropdown only if there are suggestions, otherwise hide it
          suggestionsBox.style.display = data.length ? "block" : "none";
        } catch (error) {
          console.error("Error fetching suggestions:", error); // Log errors in case of failure
        }
      }

      // Function to handle suggestion selection
      function selectTitle(title) {
        document.getElementById("title").value = title; // Set the selected title in the input field
        document.getElementById("suggestions").innerHTML = ""; // Clear the suggestions dropdown
      }
    </script>
  </body>
</html>
